/*--------------------------------------------------------------------------------------------------------------------*/

#include <string.h>

#ifdef __APPLE__
#  include <libxml/tree.h>
#else
#  include <libxml2/tree.h>
#endif

#include "indi_proxy_internal.h"

/*--------------------------------------------------------------------------------------------------------------------*/

indi_xmldoc_t *indi_xmldoc_parse(STR_t text)
{
    return (text != NULL) ? xmlReadMemory(text, strlen(text), "message.xml", "iso-8859-1", 0) : NULL;
}

/*--------------------------------------------------------------------------------------------------------------------*/

void indi_xmldoc_free(indi_xmldoc_t *doc)
{
    if(doc != NULL)
    {
        xmlFreeDoc(doc);
    }
}

/*--------------------------------------------------------------------------------------------------------------------*/

str_t indi_xmldoc_to_string(const indi_xmldoc_t *doc)
{
    if(doc == NULL)
    {
        return NULL;
    }

    /*----------------------------------------------------------------------------------------------------------------*/

    int length;

    str_t result;

    xmlDocDumpMemoryEnc((xmlDoc *) doc, (xmlChar **) &result, &length, "iso-8859-1");

    memmove(result, result + 44, length - 44 + 1);

    return result;

    /*----------------------------------------------------------------------------------------------------------------*/
}

/*--------------------------------------------------------------------------------------------------------------------*/
